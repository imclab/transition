<% content_for(:page_title, "#{@site.default_host.hostname} Mappings") %>

<%= breadcrumb(@site) %>

<div class="page-title-with-border">
  <h1>
    <span class="small"><%= @site.default_host.hostname %></span>
    Mappings
  </h1>
</div>

<%= render partial: 'site', locals: { site: @site } %>
<%= render partial: 'filters' %>

<h2><%= pluralize(number_with_delimiter(@mappings.total_count, :delimiter => ','), 'mapping', 'mappings') %></h2>

<% if (@mappings.empty? or @mappings.total_count < Mapping.default_per_page) && current_user.can_edit?(@site.organisation) %>

<% elsif current_user.can_edit?(@site.organisation) %>
  <div class="pull-left">
    <%= paginate(@mappings) %>
  </div>
<% else %>
  <div class="add-bottom-margin">
    <%= paginate(@mappings) %>
  </div>
<% end %>

<div id="archive-modal" class="modal hide">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>Archive paths</h3>
  </div>
  <div class="modal-body">
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Original paths</th>
        </tr>
      </thead>
      <tbody>
      <tr>
        <td><a href="#">/about</a></td>
      </tr>
      <tr>
        <td><a href="#">/about/us</a></td>
      </tr>
      <tr>
        <td><a href="#">/about/us/the-team/pages.aspx</a></td>
      </tr>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <a href="#" data-dismiss="modal" class="btn">Cancel</a>
    <a href="#" data-dismiss="modal" class="btn btn-success">Save</a>
  </div>
</div>

<div id="redirect-modal" class="modal hide">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>Redirect paths</h3>
  </div>
  <div class="modal-body">
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Original paths</th>
        </tr>
      </thead>
      <tbody>
      <tr>
        <td><a href="#">/about</a></td>
      </tr>
      <tr>
        <td><a href="#">/about/us</a></td>
      </tr>
      <tr>
        <td><a href="#">/about/us/the-team/pages.aspx</a></td>
      </tr>
      </tbody>
    </table>
    <div>
      <label for="redirect-to">Redirect to</label>
      <input type="text" id="redirect-to">
    </div>
    
  </div>
  <div class="modal-footer">
    <a href="#" data-dismiss="modal" class="btn">Cancel</a>
    <a href="#" data-dismiss="modal" class="btn btn-success">Save</a>
  </div>
</div>

<% if @mappings.any? %>
  <table class="mappings table table-bordered">
    <thead>
      <tr style="background-color: #eee">
        <th style="width: 30px"></th>
        <th style="width: 70px" class="mapping-type-header" scope="col">Type</th>
        <th scope="col">
            Original path from <%= @site.default_host.hostname %>
        </th>
        <th></th>
      </tr>
      <tr style="background-color: #f9f9f9; box-shadow: rgba(0,0,0,0.5) 0 2px; z-index: 1; position: relative;">
        <td>
          <label style="display: block; width: 30px; height: 30px;"><input type="checkbox" class="js-check-all">
        </td>
        <td colspan="3">
          <%= render partial: 'add_button' %>
        </td>
      </tr>
    </thead>
    <tbody>
    <% @mappings.each do |mapping| %>
      <tr data-status-code="<%= mapping.http_status %>">
        <td><label style="display: block; width: 30px; height: 30px;"><input type="checkbox" class="js-check"></label>
        <td class="mapping-type <%= "mapping-type-#{mapping.type}" %>">
          <span class="type-title"><%= mapping.type.titleize %></span>
        </td>
        <td>
          <%= link_to mapping.path, mapping.old_url, style: 'font-weight: bold' %>
          <% if mapping.redirect? %>
            <br>
            <i class="muted">redirects to</i> <%= link_to mapping.new_url, mapping.new_url, class: 'muted-link' if mapping.new_url.present? %>
          <% end %>
        </td>
        <% if current_user.can_edit?(@site.organisation) %>
          <td class="text-right" style="width: 30px">
            <%= link_to edit_site_mapping_path(@site, mapping), class: 'btn' do %>
              Edit
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
    </tbody>
  </table>
  <%= paginate(@mappings) %>

<% else %>
  <p class="no-content no-content-bordered">
    No mappings found
  </p>
<% end %>
<script>GOVUK.Mappings.toggles()</script>